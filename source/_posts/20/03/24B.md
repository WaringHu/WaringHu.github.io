---
title: 记·博客搭建
date: 2020-03-24 18:05:00
tags:
  - Blog
categories: 博客纪要
photos: https://cdn.jsdelivr.net/gh/TUFZ/ImgHosting//TUFZ-Img/article/2020/03/20Mar24B/00.png
cover: false
---

这是我第二次使用 `GitHub + Hexo` 搭建个人博客，所以成功的搭建起来并没有花太多时间，但还是遇到了一些问题，所以在此记录一下这些“🕳”，以及记录我自己添加到博客的内容。

<!-- more -->

最近有一些小伙伴留言说希望了解我站点的部分配置，有这一需求的可以查看我在 GitHub 上的站点备份👉[传送门](https://github.com/TUFZ/TUFZ.github.io/tree/backup)

# 必知概念

- 站点根目录

安装 Hexo 的文件夹就是站点根目录，例如我的：`F:\Blog\TUFZ\Hexo`

- 站点配置文件

配置站点的文件 `_config.yml`，注意与主题配置文件区分，例如我的站点配置文件：`F:\Blog\TUFZ\Hexo\_config.yml`

- 主题配置文件

配置主题的文件，在主题文件夹里，例如我的主题配置文件：`F:\Blog\TUFZ\Hexo\themes\ayer\_config.yml`

# 一些 “🕳”

## bash: hexo: command not found

首先检查一下 node.js 和 npm 是否正常，使用命令 `node -v` 和 `npm -v` 查看版本，如果有版本信息即一切正常，那么应该就是 Hexo 的环境变量没有添加，进入 Hexo --> node_modules --> .bin，复制 .bin 的文件路径，例如：`F:\Blog\TUFZ\Hexo\node_modules\.bin`

将该路径添加到系统变量的 Path 变量里，重新使用 hexo 命令即可成功执行，如还不能成功执行，重新执行 Hexo 安装语句：`npm install hexo-cli -g`

# 添加音乐

使用👉[hexo-tag-aplayer](https://github.com/MoePlayer/hexo-tag-aplayer)👈插件，最新版的 aplayer 支持 MetingJS，意味着它可以解析几乎所有网络平台的音乐资源，

**安装**

```bash
npm install hexo-tag-aplayer --save
```

安装好之后按理说就可以直接使用了，但是最好先配置一下 MetingJS，以免某些平台的音乐资源无法被解析，打开站点的配置文件，写入如下配置：

```yml
aplayer:
    meting: true
```

## 创建歌单页面

👉[这里](https://www.itufz.com/playlist/)👈是我的歌单页面

**1、首先我们新建一个 playlist**

```bash
hexo new page playlist
```

**2、配置 playlist**

执行完新建页面命令之后，在 `Hexo\source` 文件夹下面会生成一个 playlist 文件夹，该文件夹里面有一个 index.md文件，这个 `.md` 文件会经过渲染解析生成 playlist 页面，所以我们所有关于页面的代码都在这里编写

**注意：**Markdown 真的很强大，可以在里面直接写前端代码

以下是我的 index.md

```md
---
title: 音乐
type: "playlist"
---

音乐的力量💪

{% meting "4924170567" "netease" "playlist" "theme:#FF4081" "mode:circulation" "mutex:true" "listmaxheight:340px" "preload:auto" %}
```

以上 `4924170567` 是歌单的 id，随后 "netease" 表示音乐平台是网易云音乐，后面的可以默认或者查看官方说明进行修改

**3、配置访问路径**

至此我们的 playlist 页面已经准备好了，但是还没有访问入口，所以我们应该在主题配置文件里配置访问路径

打开 `F:\Blog\TUFZ\Hexo\themes\ayer\_config.yml`，一般第一条配置就是 menu，先看一下我的配置：

```yml
# 侧边栏菜单
menu:
  主页: /
  归档: /archives
  分类: /categories
  标签: /tags
  相册: /photos
  音乐: /playlist
  关于我: /about
```

可以理解为 `/` 表示 `F:\Blog\TUFZ\Hexo\source` 文件夹，所以音乐的路径就是 `/playlist`，至此该页面已经完全配置完成

## 给文章添加音乐

在文章中添加音乐只需要在文章中加入一段代码，示例：

```md
---
title: 示例文章
date: 2020-03-25 09:34:11
tags:
    - Blog
---

{% meting "3986040" "netease" "song" "theme:#555" "mutex:true" "listmaxheight:340px" "preload:auto" %}

这是我的演示文章，将上面的代码添加在哪个位置音乐就会出现在文章的哪个位置，上面的 `3986040` 是歌曲的 id，"netease" 表示音乐资源来自于网易云音乐，后面的可以默认
```

aplayer 是支持给单篇文章添加音乐的，但是我在使用中却发现：当我给文章添加了音乐之后，文章的 TOC 就不能使用了

该问题暂时未解决，该问题可能只在主题 ayer 上出现，其他主题未测试

## 音乐更新时间

我是使用网易云音乐歌单来实现音乐页面的歌曲更新的，每当网易云音乐歌单收藏里更新了音乐之后，一般 12 个小时之后博客才会更新

# 配置相册

👉[这里](https://www.itufz.com/photos/)👈是我的相册页面

配置相册跟配置音乐页面的原理一样的，先新建一个相册页面，在根目录执行

```bash
hexo new page photos
```

然后在 `Hexo\source` 下会生成一个 photos 文件夹，里面有一个 index.md 文件，文件配置如下：

```md
---
title: 相册
type: "photos"

albums: [
		["https://cdn.jsdelivr.net/gh/TUFZ/ImgHosting//TUFZ-Img/cover/cover1.jpg", "Cover1"],
		["https://cdn.jsdelivr.net/gh/TUFZ/ImgHosting//TUFZ-Img/cover/cover2.jpg", "Cover2"],
		["https://cdn.jsdelivr.net/gh/TUFZ/ImgHosting//TUFZ-Img/cover/cover8.png", "Cover8"]
]
---
```

albums 里存放的就是图片了，每一个 [] 前面的部分是图片的 URL，后面的部分是图片名称，当然你还可以编写一些代码来美化你的相册

最后一步，给你的相册配置一个入口路径，我是配置在侧边栏的，所以打开主题配置文件，在 menu 中添加一条配置：`相册: /photos`

# 设置文章置顶

使用👉[hexo-generator-index-pin-top](https://github.com/netcan/hexo-generator-index-pin-top)👈插件

**1、删除 hexo-generator-index 插件**

```bash
npm uninstall hexo-generator-index --save
```

**2、安装 hexo-generator-index-pin-top 插件**

```bash
npm install hexo-generator-index-pin-top --save
```

**3、文章配置**

在文章的 `Front-matter` 中添加 `top: true`，比如我的这篇文章：

```md
---
title: 记·博客搭建纪要
date: 2020-03-24 18:05:51
tags:
 - Blog
categories: 记录
photos: https://cdn.jsdelivr.net/gh/TUFZ/ImgHosting//TUFZ-Img/assets/20-03-24-1.jpeg
top: true
---
```

**4、修改置顶图标样式**

打开：`/Hexo/themes/next/layout/_macro` 目录下的 `post.swig` 文件，定位到 `<div class="post-meta">` 标签下，插入如下代码：

```ejs
{% if post.top %}
  <i class="fa fa-thumb-tack"></i>
  <font color=7D26CD>置顶</font>
   <span class="post-meta-divider">|</span>
{% endif %}
```

但是由于我的博客主题自带文章置顶功能，所以我完成前 3 步后我的文章就已经置顶且有一个挺不错的置顶标识了

# 配置后台管理（不推荐，已弃用）

> 使用了一段时间还是弃用了，hexo-admin 只能本地后台管理，并不实用，唯一让我眼前一亮的就是后台写文章有 Markdown 实时渲染，但是左右页面内容并不一致，会错位，体验就很差了，对了，还有一个点，在后台写文章可以直接添加图片，hexo-admin 会自动在 `Hexo/source` 下创建一个 `images` 文件夹存放添加的图片，然后使用相对路劲引用图片到文章，并不是利用图床，这样是方便了，但是也会导致网页打开需要加载的数据变得很大，拖慢页面加载速度

这里使用👉[hexo-admin](https://github.com/jaredly/hexo-admin)👈插件

**注意：hexo-admin 只能在本地进行后台管理**

**1、安装插件**

```bash
npm install hexo-admin --save
```

然后我们本地部署看看：

```bash
hexo server -d
```

进入 `http://127.0.0.1:4000/admin/` 即可查看后台

**2、设置账号密码**

点击 **Setting**

可以选择开启行数统计和拼写检查
- Enable line numbering.
- Enable spellchecking.(buggy on older browsers)

然后点击 **Setup authentification here**

填写以下信息：

+ Username
+ Password
+ Secret（这个我也不清楚是什么，随意填吧）

然后下拉就可以看见自动生成了 **Admin Config Section**

复制里面的信息，打开站点配置文件 `_config.yml` 粘贴进去，至此配置已经完成

然后重新部署以下博客

```bash
hexo clean
```

```bash
hexo g
```

```bash
hexo server -d
```

进入 `http://127.0.0.1:4000/admin/`，此时就需要我们输入之前设置的账号密码登陆

> 害，当时就该遇到问题记录一下， 现在都不知道我遇到了什么问题，尴尬😅，未完... ... 这个坑一定要填